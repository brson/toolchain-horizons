<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toolchain Horizons - Dependency Toolchain Compatibility</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="styles.css">
</head>
<body>

<div id="stars"></div>

<div id="impress" data-transition-duration="100" data-min-scale="1">

  <div class="step slide-title" data-x="0" data-y="0">
    <h1>TigerBeetle 1000x <br> Walkin Slide</h1>

    <aside class="notes">
    </aside>
  </div>

  <div class="step slide-title" data-x="0" data-y="0">
    <h1>Toolchain Horizons</h1>
    <p class="subtitle">
      Exploring<br>
      Dependency-Toolchain<br>
      Compatibility<br>
    </p>
    <p><a href="https://github.com/brson/toolchain-horizons">github.com/brson/toolchain-horizons</a></p>

    <aside class="notes">
      Thanks for coming...
    </aside>
  </div>

  <!-- act 1 -->

  <div class="step" data-x="2400" data-y="0">
    <h2>Me and TigerBeetle</h2>
    <div class="slide-content side-by-side">
      <figure>
        <div class="img-container">
          <img src="assets/brson.png" alt="Brian Anderson">
        </div>
        <figcaption><a href="https://brson.github.io">brson.github.io</a></figcaption>
      </figure>
      <figure>
        <div class="img-container">
          <img src="assets/tigerbeetle.png" alt="TigerBeetle mascot">
        </div>
        <figcaption><a href="https://tigerbeetle.com">tigerbeetle.com</a></figcaption>
      </figure>
    </div>
    <aside class="notes">
      ME: rust expert. Mozilla years.<br>
      TB: Strong technical / market niche.<br>
      TB: Joran right-minded business.<br>
      ME: No rust yes zig<br>
      ME: NO RUST YES ZIG<br>
      ME: NO RUST YES ZIG<br>
      <b>So whats this talk about ?? (next)</b>
    </aside>
  </div>

  <div class="step slide-callout" data-x="2400" data-y="0">
    <p class="callout">
      I made a<br>
      TigerBeetle<br>
      Rust client
    </p>
    <aside class="notes">
      This talk is about my experience building the TigerBeetle Rust client.
    </aside>
  </div>

  <div class="step" data-x="2400" data-y="0">
    <div class="slide-content split-horizontal">
      <div class="split-panel">
        <p>I got mad about software dependencies.</p>
        <img src="assets/frustration.jpg" alt="Frustration">
      </div>
      <div class="split-panel">
        <img src="assets/science.jpg" alt="Science experiment">
        <p>I did an experiment about it.</p>
      </div>
    </div>
    <aside class="notes">
      More specifically.<br>
      About my experience removing dependencies from the TigerBeetle Rust client.<br>
      Including experiment.
    </aside>
  </div>
  
  <div class="step" data-x="3600" data-y="0">
    <h2>TigerBeetle Clients</h2>
    <div class="slide-content client-arch">
      <div class="client-arch-diagram">
        <!-- SVG arrows pointing to center -->
        <svg class="client-arch-arrows" viewBox="0 0 600 600">
          <defs>
            <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
              <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
            </marker>
          </defs>
          <!-- Arrows from each node to center -->
          <line x1="300" y1="120" x2="300" y2="210" stroke="#666" stroke-width="3" marker-end="url(#arrowhead)"/>
          <line x1="480" y1="160" x2="400" y2="230" stroke="#666" stroke-width="3" marker-end="url(#arrowhead)"/>
          <line x1="480" y1="440" x2="400" y2="370" stroke="#666" stroke-width="3" marker-end="url(#arrowhead)"/>
          <line x1="300" y1="480" x2="300" y2="390" stroke="#666" stroke-width="3" marker-end="url(#arrowhead)"/>
          <line x1="120" y1="440" x2="200" y2="370" stroke="#666" stroke-width="3" marker-end="url(#arrowhead)"/>
          <line x1="120" y1="160" x2="200" y2="230" stroke="#666" stroke-width="3" marker-end="url(#arrowhead)"/>
        </svg>
        <!-- Outer client nodes -->
        <div class="client-arch-node"><img src="assets/python.svg" alt="Python"></div>
        <div class="client-arch-node"><img src="assets/java.svg" alt="Java"></div>
        <div class="client-arch-node"><img src="assets/go.png" alt="Go"></div>
        <div class="client-arch-node"><img src="assets/nodejs.svg" alt="Node.js"></div>
        <div class="client-arch-node"><img src="assets/dotnet.jpg" alt=".NET"></div>
        <div class="client-arch-node"><img src="assets/rust.png" alt="Rust"></div>
        <!-- Center Zig node -->
        <div class="client-arch-center">
          <img src="assets/zig.svg" alt="Zig">
        </div>
      </div>
    </div>
    <aside class="notes">
      All clients depend on tb_client, written in Zig.
    </aside>
  </div>

  <div class="step" data-x="4800" data-y="0">
    <h2>The TigerBeetle Rust Client</h2>
    <div class="slide-content split-horizontal code-split">
      <div class="split-panel">
        <ul>
          <li>Small &mdash; &lt; 2 kloc.
          <li><code>async</code> / <code>await</code>
          <li>FFI &mdash; mostly unsafe.
          <li>Partially code-generated.
        </ul>
      </div>
      <div class="split-panel">
        <pre><code>pub fn lookup_transfers(
    &self,
    events: &[u128],
) -> impl Future&lt;...&gt; {
    let (packet, rx) = create_packet(
        TB_OPERATION_LOOKUP_TRANSFERS,
        events,
    );

    unsafe {
        tb_client_submit(
            self.client,
            Box::into_raw(packet),
        );
    }

    async {
        let msg = rx.await?;
        let responses = handle_message(&msg)?;
        Ok(Vec::from(responses))
    }
}</code></pre>
      </div>
    </div>

    <aside class="notes">
      Code on slide isn't important.<br>
      &lt; 2 kloc <br>
      async / await <br>
      mostly unsafe <br>
      partial codegen <br>
      <br>
      Made initial PR in June 2025.
    </aside>
  </div>

  <div class="step" data-x="8400" data-y="0">
    <h2>Establishing a<br>Minimum Supported Rust Version</h2>
    <div class="slide-content msrv-cycle">
      <div class="msrv-cycle-diagram">
        <svg class="msrv-cycle-arrows" viewBox="0 0 100 100" preserveAspectRatio="none">
          <defs>
            <marker id="msrv-arrow" markerWidth="4" markerHeight="3" refX="3.5" refY="1.5" orient="auto">
              <polygon points="0 0, 4 1.5, 0 3" fill="#666"/>
            </marker>
          </defs>
          <!-- Arrow from step 1 to step 2 -->
          <path d="M 75 18 Q 98 18 98 38" stroke="#666" stroke-width="1" fill="none" marker-end="url(#msrv-arrow)"/>
          <!-- Arrow from step 2 to step 3 -->
          <path d="M 98 62 Q 98 82 75 82" stroke="#666" stroke-width="1" fill="none" marker-end="url(#msrv-arrow)"/>
          <!-- Arrow from step 3 to step 4 -->
          <path d="M 25 82 Q 2 82 2 62" stroke="#666" stroke-width="1" fill="none" marker-end="url(#msrv-arrow)"/>
          <!-- Arrow from step 4 back to step 1 -->
          <path d="M 2 38 Q 2 18 25 18" stroke="#666" stroke-width="1" fill="none" marker-end="url(#msrv-arrow)"/>
        </svg>
        <div class="msrv-step msrv-step-1">
          <span class="msrv-label">"We support<br>Rust version N!"</span>
        </div>
        <div class="msrv-step msrv-step-2">
          <code>N = N-1</code>
        </div>
        <div class="msrv-step msrv-step-3">
          <code>cargo +N test</code>
        </div>
        <div class="msrv-step msrv-step-4">
          <span class="msrv-label">Fix build*</span>
        </div>
      </div>
    </div>
    <aside class="notes">
      "We support version N!" -> `cargo +"N-1" test` -> Fix build* -> (back)<br>
      <br>
      * what kind of fixes?
      <br>
    </aside>
  </div>

  <div class="step slide-callout" data-x="6000" data-y="0">
    <p class="callout">
      Initial MSRV<br>
      Rust 1.81<br>
      September 5, 2024<br>
      yikes
    </p>
    <aside class="notes">
      Expected.
      Build script fs::exists, stabilized in 1.81.<br>
      Cargo lockfile v4, May 2024, todo what rust version?<br>
      This was in June 2025, 9 months later.<br>
      <b>NEXT TASK: Increase version compatibility.</b><br>
      Removing language features and dependencies.<br>
    </aside>
  </div>


  <!-- act 2 -->
  

  <div class="step slide-section" data-x="7200" data-y="0">
    <h2>The TigerStyle Mindset</h2>
    <img src="assets/enlightenment.jpg" alt="Person meditating" class="section-image">
    <p>tigerbeetle/docs/TIGER_STYLE.md</p>
    <aside class="notes">
      Interlude.<br>
      TigerBeetle strict <b>software development</b> guidelines<br>
      safety, performance, dev ux<br>
      no dependencies
    </aside>
  </div>

  <div class="step" data-x="6000" data-y="0">
    <h2>Rust Client Dependencies</h2>
    <div class="slide-content">
      <h3>Cargo.toml</h3>
      <pre>

      [dependencies]
      bitflags = "2.6.0"
      futures = "0.3.31"
      thiserror = "2.0.3"

      [build-dependencies]
      anyhow = "1.0.93"
      ignore = "0.4.23"

      [dev-dependencies]
      anyhow = "1.0.93"
      tempfile = "3.15.0"
      </pre>

      <br>
      <p style="text-align:center;"><a>https://github.com/tigerbeetle/tigerbeetle/pull/3254</a></p>
    </div>
    <aside class="notes">
      Back to the Rust client.
      Again: Initial Rust client, June 2025<br>
      Again: Rust 1.81, September 2024.<br>
      Exact deps not important.<br>
      Remember: TigerStyle says no dependencies.<br>
      <b>Need to remove most/all of them.</b><br>
      Easy ones first.<br>
    </aside>
  </div>

  <div class="step slide-code" data-x="9600" data-y="0">
    <h2>The Rust <code>futures</code> <br> Dependency Problem</h2>
      <pre class="small-code">futures v0.3.31
├── futures-channel v0.3.31
│   ├── futures-core v0.3.31
│   └── futures-sink v0.3.31
├── futures-core v0.3.31
├── futures-executor v0.3.31
│   ├── futures-core v0.3.31
│   ├── futures-task v0.3.31
│   └── futures-util v0.3.31
│       ├── futures-channel v0.3.31 (*)
│       ├── futures-core v0.3.31
│       ├── futures-io v0.3.31
│       ├── futures-macro v0.3.31 (proc-macro)
│       │   ├── proc-macro2 v1.0.90
│       │   │   └── unicode-ident v1.0.14
│       │   ├── quote v1.0.37
│       │   │   └── proc-macro2 v1.0.90 (*)
│       │   └── syn v2.0.88
│       │       ├── proc-macro2 v1.0.90 (*)
│       │       ├── quote v1.0.37 (*)
│       │       └── unicode-ident v1.0.14
│       ├── futures-sink v0.3.31
│       ├── futures-task v0.3.31
│       ├── memchr v2.7.4
│       ├── pin-project-lite v0.2.15
│       ├── pin-utils v0.1.0
│       └── slab v0.4.9
├── futures-io v0.3.31
├── futures-sink v0.3.31
├── futures-task v0.3.31
└── futures-util v0.3.31 (*)
    </pre>
    <aside class="notes">
      Dependency tree for the futures crate.<br>
      Fundamental crate.<br>
      We don't use in public API.<br>
      We use: channels, block_on executor, Stream.<br>
      Point out syn crate.<br>
      <br>
      This crate is hard to get rid of.
    </aside>
  </div>

  <div class="step" data-x="10800" data-y="0">
    <!-- blank -->
    <aside class="notes">
      STORY ABOUT SYN BEING UPDATED.<br>
      Was going to leave the futures dependency.<br>
      This was the moment that I got mad.<br>
    </aside>
  </div>

  <div class="step slide-experiment" data-x="10800" data-y="0">
    <h2>The Experiment</h2>
    <div class="slide-content split-horizontal">
      <div class="split-panel">
        <img src="assets/science-experiment.gif" alt="Science experiment animation">
      </div>
      <div class="split-panel">
        <ul>
          <li>Pick <br>
            <b>~30 popular Rust crates</b>.
          <li>Compile each of them against <br>
            <b>~every Rust toolchain</b>.
          <li>Report the toolchain version and date.
        </ul>
      </div>
    </div>
    <aside class="notes">
      Pick 30 popular Rust crates.<br>
      Compile against every Rust toolchain.<br>
      Report toolchain version / date.<br>
    </aside>
  </div>

  <div class="step slide-horizons-list" data-x="12000" data-y="0">
    <h2>Toolchain Horizons: Rust</h2>
    <div class="slide-content">
      <ul>
        <li>serde
        <li>anyhow
        <li>futures
        <li><b>syn</b>
        <li>rayon
        <li>walkdir
        <li>etc.
      </ul>
    </div>
    <aside class="notes">
      Some of the crates being tested.
      serde - 600m downloads.
    </aside>
  </div>

  <div class="step slide-image" data-x="12000" data-y="0">
    <div class="slide-content">
      <img src="../compatibility-timeline-rust.png" alt="Rust compatibility timeline">
    </div>
    <aside class="notes">
      Hard to read; visual<br>
      NB: Start: 2019, 1.31<br>
      NB: End: 1.83<br>
    </aside>
  </div>


  <!-- act 3 -->


  <div class="step slide-section" data-x="13200" data-y="0">
    <h2><i>A TigerBeetle<br>Rust Client<br>Compatibility Quest!</i></h2>
    <img src="assets/quest-hiker.jpg" alt="Hikers on mountain trail" class="section-image">
    <aside class="notes">
      Next: about the process of removing Rust dependencies.<br>
      Personal quest.<br>
      Some in-tree, some not.<br>
    </aside>
  </div>

  <div class="step" data-x="9600" data-y="0">
    <h2>Compatibility Quest Timeline</h2>
    <div class="slide-content">
      <ul class="timeline-list">
        <li><b>1.81</b> (Sep 2024) &mdash; Initial MSRV &mdash; <code>fs::exists</code></li>
        <li><b>1.63</b> (Aug 2022) &mdash; remove deps &mdash; <code>const Mutex::new</code>, <code>try_exists</code></li>
        <li><b>1.58</b> (Jan 2022) &mdash; format strings &mdash; <code>{variable}</code> captures</li>
        <li><b>1.56</b> (Oct 2021) &mdash; edition 2018 &mdash; Edition 2021</li>
        <li><b>1.51</b> (Mar 2021) &mdash; reserved types &mdash; const generics</li>
        <li><b>1.47</b> (Oct 2020) &mdash; manual impls &mdash; array traits &gt; 32</li>
        <li><b>1.42</b> (Mar 2020) &mdash; stdlib &mdash; <code>matches!</code>, <code>u64::MAX</code></li>
        <li><b>1.39</b> (Nov 2019) &mdash; minimum &mdash; <code>async</code>/<code>await</code></li>
      </ul>
      <p style="margin-top: 1em;"><b>Result: 1.39 (Nov 2019) &mdash; 5 years of compatibility</b></p>
    </div>
    <aside class="notes">
      Phase 1: Remove dependencies (1.81 -> 1.63)<br>
      Phase 2: Remove language features (1.63 -> 1.39)<br>
      Final MSRV: 1.39, November 2019.<br>
      5 years of compatibility vs 9 months initially.
    </aside>
  </div>

  <div class="step" data-x="9600" data-y="0">
    <h2>Removing the <code>futures</code> Dependency</h2>
    <div class="slide-content">
      <p>Content placeholder</p>
    </div>
    <aside class="notes">
      todo
    </aside>
  </div>

  <div class="step" data-x="7200" data-y="0">
    <h2>Does It Even Matter?</h2>
    <div class="slide-content">
      <p>Content placeholder</p>
    </div>
    <aside class="notes">
      Can't use tokio in examples or docs.
    </aside>
  </div>

  <div class="step slide-section" data-x="0" data-y="0">
    <h2>Time Check</h2>

    <aside class="notes">
      Do we have time for more?
    </aside>
  </div>

  <div class="step slide-title" data-x="0" data-y="0">
    <h1>Toolchain Horizons</h1>
    <p class="subtitle">
      Exploring<br>
      Dependency-Toolchain<br>
      Compatibility<br>
    </p>
    <p><a href="https://github.com/brson/toolchain-horizons">github.com/brson/toolchain-horizons</a></p>

    <aside class="notes">
      Thanks for coming...
    </aside>
  </div>


  <!-- appendices -->

  <div class="step slide-section" data-x="13200" data-y="0">
    <h2>Appendix</h2>
  </div>

  <div class="step" data-x="14400" data-y="0">
    <h2>Toolchain Horizons: Java</h2>
    <div class="slide-content">
      <p>Java doesn't seem to have this problem.</p>
    </div>
    <aside class="notes">
      todo
    </aside>
  </div>

  <div class="step" data-x="14400" data-y="0">
    <h2>Toolchain Horizons: Go</h2>
    <div class="slide-content">
      <p>Modules introduced 1.13, September 19.</p>
      <p>~60% compatibility.</p>
    </div>
    <aside class="notes">
      Go 1.13 (60%): mux, cobra, logrus, yaml, pq, uuid, websocket, httprouter, jwt-go, redigo, elasticsearch, aws-sdk.<br>
      Go 1.17-1.19: testify, cli/v2, chi, zap.<br>
      Go 1.21 (30%): gin, echo, grpc, prometheus, x/sync, x/crypto, mysql, resty.<br>
      Modern web frameworks and Google libs require recent Go.
    </aside>
  </div>

  <div class="step slide-image" data-x="12000" data-y="0">
    <div class="slide-content">
      <img src="../compatibility-timeline-go.png" alt="Go compatibility timeline">
    </div>
    <aside class="notes">
      todo
    </aside>
  </div>

  <div class="step slide-title" data-x="0" data-y="0">
    <h1>Toolchain Horizons</h1>
    <p class="subtitle">
      Exploring<br>
      Dependency-Toolchain<br>
      Compatibility<br>
    </p>
    <p><a href="https://github.com/brson/toolchain-horizons">github.com/brson/toolchain-horizons</a></p>

    <aside class="notes">
      Thanks for coming...
    </aside>
  </div>

</div>

<script src="impress.js"></script>
<script src="presentation.js"></script>

</body>
</html>

<!--

    msvr slide in wrong place
    name feature epochs in rust chart
    
    -->
